# Дискретная автоматная модель психологического взаимодействия (Версия 2.0)

Этот документ является расширением и уточнением исходной спецификации (v1.0). Он фиксирует исправления критических ошибок и внедрение новых динамических законов.

---

## 1. Изменения в базовой логике (Bug Fixes)

### 1.1. Принцип Взаимности (Симметрия)
Взаимодействие $\sigma_{i,j}(t)$ теперь является двусторонним актом. Любое изменение реляционных функций $U, A, T, R$ происходит одновременно для обоих участников контакта (если иное не задано сценарием). 
- Исправлена асимметрия в парах Агент-Агент.
- Исправлена асимметрия в парах Агент-Игрок.

### 1.2. Непрерывность функций (Continuous Values)
В Версии 2.1 произведен отказ от дискретизации. Реляционные функции $U, A, T, R$ и эмоциональные состояния $E_i$ теперь являются вещественными числами (тип `float`).
- **Следствие**: Округления `round()` и `int()` в расчетах изменений запрещены.
- **Интерфейс**: Округление до целого допускается только при выводе текстовых описаний или в GUI.
- **Диапазон**: Предикаты сохраняют границы $[-10, 10] \cap \mathbb{R}$, эмоции — $[-3, 3] \cap \mathbb{R}$.

---

## 2. Новые формальные законы

### 2.1. Закон Прощения (Relation Decay)
Отношения в коллективе не являются константами. При отсутствии активного взаимодействия значения реляционных функций стремятся к нейтральному состоянию (0).

**Формула обновления:**
$$V(t+1) = V(t) - \text{sgn}(V(t)) \cdot (\text{decay\_rate} \cdot s_i)$$

Где:
- $V(t)$ — текущее значение (Affinity, Trust или Utility).
- $\text{sgn}(x)$ — функция знака.
- $\text{decay\_rate}$ — параметр архетипа (скорость «забывания»).
- $s_i$ — индивидуальная чувствительность агента.

*Следствие:* Отрицательные отношения «прощаются», а положительные «остывают» со временем.

### 2.2. Закон Эмоциональной Энтропии (Emotion Decay)
Эмоциональные состояния не могут длиться вечно. В отсутствие стимуляции от внешних взаимодействий или группового влияния, уровни всех 7 эмоциональных осей стремятся к нейтральному состоянию (0).

**Формула:**
$$E(t+1) = E(t) - \text{sgn}(E(t)) \cdot (\text{emotion\_decay\_rate} \cdot s_i)$$

Где:
- $E(t)$ — текущее состояние по оси.
- $\text{emotion\_decay\_rate}$ — базовая скорость затухания (типично $0.2$).
- $s_i$ — индивидуальная чувствительность.

### 2.3. Демпфирование Фонового Влияния (Background Influence Damping)
В Версии 2.2 (январь 2026) обнаружена проблема «эмоциональной инфляции»: средние значения симпатии и доверия в больших группах создавали избыточное фоновое давление, приводящее к зашкаливанию всех эмоций до максимума (±3).

**Решение:**
Введен коэффициент демпфирования $\alpha = 0.1$ для фонового влияния от отношений:

$$\Delta E_{axis} = \alpha \cdot \frac{\overline{A} + \overline{T}}{2} \cdot c_{axis} \cdot s_i$$

Где:
- $\overline{A}, \overline{T}$ — средние значения Affinity и Trust ко всем агентам в группе.
- $c_{axis}$ — коэффициент влияния оси из архетипа (emotion_coefficients).
- $\alpha = 0.1$ — демпфирующий множитель.

**Обоснование:** Отношения теперь создают лишь «намёк» на эмоциональное состояние, оставляя основную роль дискретным взаимодействиям ($\sigma$) и групповому влиянию через C++ ядро.

### 2.4. Стохастический выбор примарной эмоции
При равенстве нескольких эмоций по модулю (частый случай при достижении пределов), агент теперь выбирает одну из них **случайно**, а не детерминированно первую по списку. Это обеспечивает визуальное разнообразие в GUI при сохранении математической корректности.

---

## 3. Расширенные параметры Архетипов

Архетип теперь определяет не только веса эмоций, но и параметры динамики отношений:

| Архетип | Refusal Chance (Шанс отказа) | Decay Rate (Скорость прощения) | Описание |
| :--- | :--- | :--- | :--- |
| **Erudition** | 0.2 | 0.1 | Умеренное прощение. |
| **Enigmata** | 0.7 | 0.4 | Быстрая смена отношений, «вспыльчивость». |
| **Harmony** | 0.1 | 0.05 | Долго помнит хорошее и плохое. |
| **HUNT** | 0.3 | 0.15 | Решительность, средний темп изменений. |
| **Elation** | 0.5 | 0.3 | Высокая динамика, легкое отношение к связям. |
| **Preservation**| 0.15 | 0.05 | Высокая инерция, стабильность. |
| **Nihility** | 0.6 | 0.2 | Склонность к обесцениванию. |
| **Remembrance** | 0.2 | 0.02 | Минимальное затухание, «вечная память». |

---

## 4. Групповое влияние (Collective Influence)

Агенты в коллективе влияют на эмоции друг друга не только через дискретные акты $\sigma$, но и через фоновое присутствие:
- Примарная эмоция агента $A_i$ транслируется на $A_j$ через коэффициент реляционной связи.
- Расчет: `ΔE = E_i * (Affinity + Trust + Utility)/3 * s_j`.

---

## 5. Программная архитектура (Refactored)

- **Collective**: Координатор шагов, лишен магических чисел.
- **InteractionStrategy**: Чистая математика решений и обновлений.
- **AgentFactory**: Источник детерминированной инициализации.

---

## 6. Вероятностный выбор цели (Softmax Selection)

*Запланировано к внедрению (v2.1)*

Для повышения реалистичности детерминированный выбор максимального приоритета заменяется на взвешенный случайный выбор.

**Формула вероятности выбора цели $i$:**
$$P(target_i) = \frac{e^{score_i / T}}{\sum_{j \in K} e^{score_j / T}}$$

Где:
- $score_i$ — приоритетный балл (Priority Score) цели.
- $T$ — температура рациональности (параметр архетипа).
- $K$ — множество доступных кандидатов (Mandatory или Optional).

**Интерпретация температуры:**
- $T \approx 0.1$: Почти детерминированный выбор (агент выбирает строго лучшего).
- $T = 1.0$: Стандартное распределение.
- $T > 3.0$: Высокая доля случайности в поведении.
